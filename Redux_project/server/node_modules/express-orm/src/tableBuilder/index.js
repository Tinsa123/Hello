const allowedCyphers = [
    'md5',
    'sha256',
    'sha512'
]

const allowedDataTypes = [
    { name: String, value: "varchar" },
    { name: Number, value: "BIGINT" },
    { name: Boolean, value: "BOOLEAN" },
    { name: Date, value: "DATETIME" },
]



const tableBuilder = (name, object) => {
    //automatically creates an id field
    sql = "CREATE TABLE IF NOT EXISTS "+name+" ( \n\tid BIGINT PRIMARY KEY AUTO_INCREMENT, \n"
    lengthCounter = 1
    for(let i in object){
        let name = i
        options = ""
        let value
        for(let j in allowedDataTypes){
            if(allowedDataTypes[j].name == object[i].type){
                if(allowedDataTypes[j].name == String){
                    if(object[i].length){
                        value = allowedDataTypes[j].value+"("+Number(object[i].length)+")"
                    }
                    else{
                        value = allowedDataTypes[j].value+"(255)"
                    }
                    
                }
                else{
                    value = allowedDataTypes[j].value
                }
                break
            }
            else {
                value = false
            }
        }
        if(object[i].notNull){
            options+=" NOT NULL "
        }
        if(object[i].unique){
            options+= " UNIQUE "
        }
        if(object[i].default){
            options+= " DEFAULT "+"'"+object[i].default+"'"
        }

        if(!value) throw "unknown datatype in column "+name

        sql += "\t"+name+" "+value+" "+options+", \n"
        
        lengthCounter ++
    }
    sql+= "\tcreated_at DATETIME NOT NULL DEFAULT NOW(), \n\tupdated_at DATETIME NOT NULL DEFAULT NOW()\n"
    sql += ");"
    return sql.split("  ").join(" ")
}

/*
let x = tableBuilder("testtable", {
    name: { type: String, length: 256, notNull: true },
    username: { type: String, notNull: true, unique: true },
    email: { type: String, notNull: true, unique: true },
    password: { type: String, notNull: true, cypher: "sha256" },
    profile_picture: { type: String, notNull: true, unique: true, default: "test" }
})

console.log(x)
*/



module.exports = tableBuilder

